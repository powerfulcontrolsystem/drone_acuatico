#!/bin/bash
# Script de informaciÃ³n sobre el sensor de peso HX711

echo "================================================================"
echo "  SENSOR DE PESO HX711 - CONFIGURACIÃ“N"
echo "================================================================"
echo ""
echo "ðŸ“Š ESTADO ACTUAL: DESACTIVADO (esperando conexiÃ³n fÃ­sica)"
echo ""
echo "El servidor estÃ¡ preparado para recibir el sensor de peso HX711"
echo "cuando lo conectes. Por ahora retorna 0.0 kg para evitar"
echo "alertas falsas y el pitido molesto."
echo ""
echo "================================================================"
echo "  CÃ“MO CONECTAR EL SENSOR HX711"
echo "================================================================"
echo ""
echo "Conexiones GPIO:"
echo "  â€¢ HX711 VCC  â†’ Raspberry Pi 5V (Pin 2 o 4)"
echo "  â€¢ HX711 GND  â†’ Raspberry Pi GND (Pin 6, 9, 14, 20, 25, 30, 34, 39)"
echo "  â€¢ HX711 DT   â†’ GPIO 5 (Pin 29)"
echo "  â€¢ HX711 SCK  â†’ GPIO 6 (Pin 31)"
echo ""
echo "================================================================"
echo "  ACTIVAR SENSOR CUANDO LO CONECTES"
echo "================================================================"
echo ""
echo "1. Instalar librerÃ­a HX711:"
echo "   cd ~/drone\\ acuatico"
echo "   source venv_pi/bin/activate"
echo "   pip install hx711"
echo ""
echo "2. Editar drone_server.py:"
echo "   - Buscar la funciÃ³n 'leer_sensor_peso()'"
echo "   - Descomentar las lÃ­neas del HX711 (estÃ¡n marcadas con #)"
echo "   - Comentar la lÃ­nea: ultima_lectura_peso = 0.0"
echo ""
echo "3. Calibrar el sensor:"
echo "   - Ejecutar el script de calibraciÃ³n incluido en la librerÃ­a"
echo "   - Ajustar los valores de calibraciÃ³n"
echo ""
echo "4. Reiniciar el servidor:"
echo "   pkill -f drone_server.py"
echo "   nohup python3 drone_server.py > drone_gps.log 2>&1 &"
echo ""
echo "================================================================"
echo "  CONFIGURACIÃ“N DE ALERTAS"
echo "================================================================"
echo ""
echo "â€¢ Umbral de alerta: 5.0 kg (configurable en PESO_UMBRAL)"
echo "â€¢ Frecuencia de lectura: cada 2 segundos"
echo "â€¢ Alerta visual: Panel parpadea en rojo"
echo "â€¢ Alerta sonora: Pitido cuando peso > umbral"
echo ""
echo "Para cambiar el umbral, edita en drone_server.py:"
echo "  PESO_UMBRAL = 5.0  # Cambiar a tu valor deseado"
echo ""
echo "================================================================"
echo "  VERIFICACIÃ“N ACTUAL"
echo "================================================================"
echo ""
echo "Estado del servidor:"
ps aux | grep drone_server | grep -v grep || echo "  âŒ Servidor no estÃ¡ corriendo"

if ps aux | grep drone_server | grep -v grep > /dev/null; then
    echo "  âœ… Servidor corriendo"
    echo ""
    echo "Ãšltima lectura de peso en logs:"
    grep "peso" ~/drone\ acuatico/drone_gps.log | tail -1 || echo "  Sin lecturas aÃºn"
fi

echo ""
echo "================================================================"
echo ""
echo "RESUMEN:"
echo "  âœ… Pitido desactivado hasta conectar sensor"
echo "  âœ… GPS funcionando normalmente"
echo "  âœ… Sistema listo para sensor HX711"
echo ""
echo "================================================================"
