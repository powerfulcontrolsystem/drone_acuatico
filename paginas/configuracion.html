<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuraci√≥n - Drone Acu√°tico</title>
    main {
      max-width: 520px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 28px;
    }
    .card {
      background: #232e43;
      border-radius: 12px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.18);
      padding: 22px 20px 18px 20px;
      margin-bottom: 0;
      border: 1.5px solid #2a3748;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 18px 16px;
    }
    .grid > div, .grid-uno > div {
      flex: 1 1 180px;
      min-width: 140px;
    }
    .grid-uno {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    label {
      font-size: 13px;
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #8a92a0;
    }
    input, select {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      background: #1a2332;
      color: #e8edef;
      border: 1.5px solid #2a3748;
      border-radius: 7px;
      margin-bottom: 2px;
      transition: border 0.18s;
    }
    input:focus, select:focus {
      border-color: #4a9eff;
    }
    input[type="checkbox"] {
      width: auto;
      margin-right: 8px;
      accent-color: #4a9eff;
    }
    small {
      display: block;
      margin-top: 4px;
      font-size: 11px;
      opacity: 0.75;
      color: #b0b8c2;
    }
    .row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
    }
    .row label { margin: 0; }
    footer {
      margin-top: 32px;
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .msg {
      text-align: center;
      font-size: 13px;
      margin-top: 12px;
      padding: 10px;
      background: #232e43;
      border-radius: 8px;
      color: #4a9eff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    }
    .btn {
      font-size: 14px;
      padding: 12px 22px;
      border-radius: 999px;
      background: linear-gradient(90deg, #4a9eff 60%, #6a8cff 100%);
      color: #fff;
      border: none;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(74,158,255,0.10);
      cursor: pointer;
      transition: background 0.18s, box-shadow 0.18s, transform 0.12s;
      outline: none;
      letter-spacing: 0.02em;
      position: relative;
      z-index: 1;
    }
    .btn:hover {
      background: linear-gradient(90deg, #3a8ae5 60%, #4a9eff 100%);
      box-shadow: 0 4px 16px rgba(74,158,255,0.18);
      transform: translateY(-2px) scale(1.04);
    }
    .btn:active {
      transform: scale(0.98);
      box-shadow: 0 1px 3px rgba(74,158,255,0.10);
    }
    @media (max-width: 600px) {
      main { padding: 0 2px; }
      .card { padding: 12px 4px 10px 4px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>‚öôÔ∏è Configuraci√≥n del Drone Acu√°tico</h1>
    <div style="display: flex; gap: 12px; align-items: center;">
      <button class="btn btn-volver" onclick="volverAlControl()">‚üµ Volver al Control</button>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>üîß Sistema</h2>
      <div class="grid">
        <div>
          <label for="ipPublica">IP p√∫blica de la Raspberry</label>
          <input id="ipPublica" type="text" placeholder="Ej: 192.168.1.7" />
        </div>
        <div class="row" style="margin-top: 18px;">
          <input id="solicitarPassword" type="checkbox" />
          <label for="solicitarPassword">Solicitar contrase√±a al iniciar</label>
        </div>
        <div>
          <label for="correo">Correo electr√≥nico</label>
          <input id="correo" type="email" placeholder="correo@ejemplo.com" />
        </div>
        <div>
          <label for="passwordNueva">Nueva contrase√±a</label>
          <input id="passwordNueva" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
      </div>
    </section>

    <section class="card">
      <h2>üó∫Ô∏è Mapa GPS</h2>
      <div class="grid">
        <div>
          <label for="tamanoMapa">Tama√±o del mapa (px altura)</label>
          <input id="tamanoMapa" type="number" min="200" max="1200" step="10" placeholder="400" value="400" />
        </div>
        <div>
          <label for="frecuenciaGuardado">Frecuencia de guardado (segundos)</label>
          <input id="frecuenciaGuardado" type="number" min="5" max="300" step="1" placeholder="30" value="30" />
          <small style="display: block; margin-top: 4px; opacity: 0.8;">Solo si el guardado autom√°tico est√° activado</small>
        </div>
      </div>
      <div class="row" style="margin-top: 12px;">
        <input id="guardarRecorrido" type="checkbox" />
        <label for="guardarRecorrido">‚úì Guardar recorrido autom√°ticamente</label>
      </div>
      <div id="mapa-gps-container" style="width: 100%; display: flex; justify-content: center; margin-top: 18px;"></div>
    </section>

    <section class="card">
      <h2>üìä Datos de Control</h2>
      <div class="grid">
        <div>
          <label for="tamanoLetraDatos">Tama√±o de letra de los datos (px)</label>
          <input id="tamanoLetraDatos" type="number" min="8" max="24" step="1" placeholder="12" />
          <small style="display: block; margin-top: 4px; opacity: 0.8;">Afecta: RAM, Temp, Bater√≠a, Red, GPS, etc.</small>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>üì∑ C√°maras</h2>
      <div class="grid-uno">
        <div>
          <label for="urlCamara1SD">URL RTSP C√°mara 1 - Calidad SD</label>
          <input id="urlCamara1SD" type="text" placeholder="rtsp://usuario:clave@192.168.1.9:554/live/ch0" />
        </div>
        <div>
          <label for="urlCamara1HD">URL RTSP C√°mara 1 - Calidad HD/2K</label>
          <input id="urlCamara1HD" type="text" placeholder="rtsp://usuario:clave@192.168.1.9:554/live/ch1" />
        </div>
        <div class="row" style="margin-top: 18px;">
          <input id="desactivarCamara1" type="checkbox" />
          <label for="desactivarCamara1">Desactivar C√°mara 1</label>
        </div>
        <div style="margin-top: 10px;">
          <label for="urlCamara2SD">URL RTSP C√°mara 2 - Calidad SD</label>
          <input id="urlCamara2SD" type="text" placeholder="rtsp://usuario:clave@192.168.1.10:554/live/ch0" />
        </div>
        <div>
          <label for="urlCamara2HD">URL RTSP C√°mara 2 - Calidad HD/2K</label>
          <input id="urlCamara2HD" type="text" placeholder="rtsp://usuario:clave@192.168.1.10:554/live/ch1" />
        </div>
        <div class="row" style="margin-top: 18px;">
          <input id="desactivarCamara2" type="checkbox" />
          <label for="desactivarCamara2">Desactivar C√°mara 2</label>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>‚ö° Nombres de Rel√©s (1‚Äì9)</h2>
      <div class="grid">
        <div>
          <label for="rele1">Rel√© 1</label>
          <input id="rele1" type="text" placeholder="Nombre 1" />
        </div>
        <div>
          <label for="rele2">Rel√© 2</label>
          <input id="rele2" type="text" placeholder="Nombre 2" />
        </div>
        <div>
          <label for="rele3">Rel√© 3</label>
          <input id="rele3" type="text" placeholder="Nombre 3" />
        </div>
        <div>
          <label for="rele4">Rel√© 4</label>
          <input id="rele4" type="text" placeholder="Nombre 4" />
        </div>
        <div>
          <label for="rele5">Rel√© 5</label>
          <input id="rele5" type="text" placeholder="Nombre 5" />
        </div>
        <div>
          <label for="rele6">Rel√© 6</label>
          <input id="rele6" type="text" placeholder="Nombre 6" />
        </div>
        <div>
          <label for="rele7">Rel√© 7</label>
          <input id="rele7" type="text" placeholder="Nombre 7" />
        </div>
        <div>
          <label for="rele8">Rel√© 8</label>
          <input id="rele8" type="text" placeholder="Nombre 8" />
        </div>
        <div class="grid-uno">
          <label for="rele9">Rel√© 9</label>
          <input id="rele9" type="text" placeholder="Nombre 9" />
        </div>
      </div>
    </section>
  </main>

  <footer>
    <button class="btn btn-guardar" onclick="guardarConfig()">üíæ Guardar</button>
    <button class="btn btn-cargar" onclick="cargarConfig()">‚§≥ Cargar</button>
  </footer>
  <div id="mensaje" class="msg"></div>

  <script>
        // Mostrar el mapa con la ubicaci√≥n actual
        function mostrarUbicacionActual() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
              const lat = pos.coords.latitude;
              const lon = pos.coords.longitude;
              if (window.mostrarMapaGPS) {
                window.mostrarMapaGPS(lat, lon);
              } else {
                const script = document.createElement('script');
                script.src = 'leaflet_loader.js';
                script.onload = function() {
                  window.mostrarMapaGPS(lat, lon);
                };
                document.body.appendChild(script);
              }
            }, function(err) {
              setMsg('No se pudo obtener la ubicaci√≥n actual.', false);
            });
          } else {
            setMsg('Geolocalizaci√≥n no soportada.', false);
          }
        }
        document.addEventListener('DOMContentLoaded', mostrarUbicacionActual);
    const API = '/api/config';

    function volverAlControl() {
      window.location.href = '/';
    }

    function setMsg(texto, ok = true) {
      const el = document.getElementById('mensaje');
      el.textContent = texto;
      el.style.color = ok ? '#B2FF59' : '#FFCDD2';
      setTimeout(() => el.textContent = '', 3000);
    }

    function recogerConfig() {
      return {
        ip_publica: document.getElementById('ipPublica').value.trim(),
        solicitar_password: document.getElementById('solicitarPassword').checked,
        correo: document.getElementById('correo').value.trim(),
        tamano_mapa: parseInt(document.getElementById('tamanoMapa').value || '400', 10),
        tamano_letra_datos: parseInt(document.getElementById('tamanoLetraDatos').value || '12', 10),
        guardar_recorrido: document.getElementById('guardarRecorrido').checked,
        frecuencia_guardado: parseInt(document.getElementById('frecuenciaGuardado').value || '30', 10),
        url_camara1_sd: document.getElementById('urlCamara1SD').value.trim(),
        url_camara1_hd: document.getElementById('urlCamara1HD').value.trim(),
        desactivar_camara1: document.getElementById('desactivarCamara1').checked,
        url_camara2_sd: document.getElementById('urlCamara2SD').value.trim(),
        url_camara2_hd: document.getElementById('urlCamara2HD').value.trim(),
        desactivar_camara2: document.getElementById('desactivarCamara2').checked,
        reles: {
          1: document.getElementById('rele1').value.trim(),
          2: document.getElementById('rele2').value.trim(),
          3: document.getElementById('rele3').value.trim(),
          4: document.getElementById('rele4').value.trim(),
          5: document.getElementById('rele5').value.trim(),
          6: document.getElementById('rele6').value.trim(),
          7: document.getElementById('rele7').value.trim(),
          8: document.getElementById('rele8').value.trim(),
          9: document.getElementById('rele9').value.trim()
        }
      };
    }

    function llenarCampos(cfg) {
      if (!cfg) return;
      document.getElementById('ipPublica').value = cfg.ip_publica || '';
      document.getElementById('solicitarPassword').checked = !!cfg.solicitar_password;
      document.getElementById('correo').value = cfg.correo || '';
      document.getElementById('tamanoMapa').value = cfg.tamano_mapa || 400;      document.getElementById('tamanoLetraDatos').value = cfg.tamano_letra_datos || 12;      document.getElementById('guardarRecorrido').checked = !!cfg.guardar_recorrido;
      document.getElementById('frecuenciaGuardado').value = cfg.frecuencia_guardado || 30;
      document.getElementById('urlCamara1SD').value = cfg.url_camara1_sd || '';
      document.getElementById('urlCamara1HD').value = cfg.url_camara1_hd || '';
      document.getElementById('desactivarCamara1').checked = !!cfg.desactivar_camara1;
      document.getElementById('urlCamara2SD').value = cfg.url_camara2_sd || '';
      document.getElementById('urlCamara2HD').value = cfg.url_camara2_hd || '';
      document.getElementById('desactivarCamara2').checked = !!cfg.desactivar_camara2;
      if (cfg.reles) {
        for (let i = 1; i <= 9; i++) {
          const val = (cfg.reles[i] || '');
          document.getElementById('rele'+i).value = val;
        }
      }
    }

    async function guardarConfig() {
      const cfg = recogerConfig();
      try {
        const res = await fetch(API, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(cfg) });
        const data = await res.json();
        if (data.exito) setMsg('Configuraci√≥n guardada en la base de datos.');
        else setMsg('Error en guardado: ' + (data.mensaje || 'Desconocido'), false);
      } catch (e) {
        setMsg('Error conectando al servidor.', false);
      }
    }

    async function cargarConfig() {
      try {
        const res = await fetch(API);
        if (!res.ok) return setMsg('Sin configuraci√≥n en servidor.', false);
        const cfg = await res.json();
        llenarCampos(cfg);
        setMsg('Configuraci√≥n cargada desde servidor.');
      } catch (e) {
        setMsg('Error cargando configuraci√≥n del servidor.', false);
      }
    }

    window.onload = function() {
      cargarConfig();
    };
  </script>  <script src="tema.js"></script></body>
</html>
