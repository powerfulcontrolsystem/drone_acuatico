<!DOCTYPE html>
<html>
<head>
    <title>Test WebSocket - Nombres Relés</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        #log { border: 1px solid #0f0; padding: 10px; height: 500px; overflow-y: scroll; }
        .mensaje { margin: 5px 0; padding: 5px; background: #2a2a2a; }
        .conexion { color: #0ff; }
        .nombres { color: #ff0; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Test WebSocket - Nombres de Relés</h1>
    <div id="log"></div>

    <script>
        const log = document.getElementById('log');
        
        function agregarLog(mensaje, clase = '') {
            const div = document.createElement('div');
            div.className = 'mensaje ' + clase;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + mensaje;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        agregarLog('Conectando al WebSocket...', 'conexion');
        
        const ws = new WebSocket('ws://localhost:8080/ws');
        
        ws.onopen = function() {
            agregarLog('✓ WebSocket conectado', 'conexion');
        };
        
        ws.onmessage = function(event) {
            const datos = JSON.parse(event.data);
            agregarLog('Mensaje recibido: tipo=' + datos.tipo);
            
            if (datos.tipo === 'conexion' && datos.nombres_reles) {
                agregarLog('✓ NOMBRES RECIBIDOS:', 'nombres');
                for (let i = 1; i <= 9; i++) {
                    agregarLog(`  Relé ${i}: ${datos.nombres_reles[i]}`, 'nombres');
                }
            }
            
            if (datos.tipo === 'config_actual' && datos.datos && datos.datos.reles) {
                agregarLog('✓ CONFIGURACIÓN RECIBIDA:', 'nombres');
                for (let i = 1; i <= 9; i++) {
                    agregarLog(`  Relé ${i}: ${datos.datos.reles[i]}`, 'nombres');
                }
            }
            
            agregarLog('JSON completo: ' + JSON.stringify(datos, null, 2));
        };
        
        ws.onclose = function() {
            agregarLog('✗ WebSocket desconectado', 'conexion');
        };
        
        ws.onerror = function(error) {
            agregarLog('✗ Error: ' + error, 'conexion');
        };
    </script>
</body>
</html>
