#!/bin/bash
# Generar c√≥digo QR para acceso f√°cil desde celular

echo "================================================================"
echo "  ACCESO DESDE CELULAR - DRONE ACU√ÅTICO"
echo "================================================================"
echo ""
echo "‚úÖ Servidor corriendo en:"
echo ""
echo "   IP:     192.168.1.8"
echo "   Puerto: 8080"
echo ""
echo "================================================================"
echo "  C√ìMO ACCEDER DESDE TU CELULAR"
echo "================================================================"
echo ""
echo "1. Aseg√∫rate de que tu celular est√© en la misma red WiFi"
echo "   que la Raspberry Pi"
echo ""
echo "2. Abre el navegador de tu celular (Chrome, Safari, etc.)"
echo ""
echo "3. Escribe en la barra de direcci√≥n:"
echo ""
echo "   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
echo "   ‚îÇ  http://192.168.1.8:8080           ‚îÇ"
echo "   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
echo ""
echo "4. ¬°Listo! Ver√°s la interfaz de control con:"
echo "   ‚Ä¢ üìç Mapa GPS en tiempo real"
echo "   ‚Ä¢ ‚ö° Control de rel√©s"
echo "   ‚Ä¢ üéÆ Control de movimiento"
echo "   ‚Ä¢ üìä Sensor de peso (cuando lo conectes)"
echo ""
echo "================================================================"
echo "  C√ìDIGO QR PARA ACCESO R√ÅPIDO"
echo "================================================================"
echo ""

# Generar c√≥digo QR si qrencode est√° instalado
if command -v qrencode &> /dev/null; then
    qrencode -t ANSIUTF8 "http://192.168.1.8:8080"
    echo ""
    echo "Escanea este c√≥digo QR con tu celular"
else
    echo "Para generar un c√≥digo QR, instala qrencode:"
    echo "  sudo apt-get install qrencode"
    echo ""
    echo "Mientras tanto, puedes usar este servicio web:"
    echo "  https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=http://192.168.1.8:8080"
fi

echo ""
echo "================================================================"
echo "  VERIFICACI√ìN"
echo "================================================================"
echo ""

# Verificar estado del servidor
if ps aux | grep -v grep | grep drone_server.py > /dev/null; then
    echo "‚úÖ Servidor corriendo"
    echo "‚úÖ Escuchando en 0.0.0.0:8080 (todas las interfaces)"
    echo "‚úÖ Accesible desde cualquier dispositivo en la red"
else
    echo "‚ùå Servidor NO est√° corriendo"
    echo ""
    echo "Inicia el servidor con:"
    echo "  cd ~/drone\\ acuatico"
    echo "  source venv_pi/bin/activate"
    echo "  nohup python3 drone_server.py > drone_gps.log 2>&1 &"
fi

echo ""
echo "================================================================"
echo "  SOLUCI√ìN DE PROBLEMAS"
echo "================================================================"
echo ""
echo "Si no puedes acceder desde el celular:"
echo ""
echo "1. Verifica que est√©s en la misma red WiFi:"
echo "   ‚Ä¢ Raspberry Pi: 192.168.1.8"
echo "   ‚Ä¢ Verifica tu celular en Ajustes > WiFi"
echo ""
echo "2. Prueba hacer ping desde tu celular:"
echo "   ‚Ä¢ Android: Usa app 'PingTools' o 'Network Utilities'"
echo "   ‚Ä¢ iPhone: Usa app 'Network Ping Lite'"
echo "   ‚Ä¢ Hacer ping a: 192.168.1.8"
echo ""
echo "3. Verifica firewall (poco probable en Raspberry Pi):"
echo "   sudo iptables -L | grep 8080"
echo ""
echo "4. Reinicia el servidor si es necesario:"
echo "   pkill -f drone_server.py"
echo "   cd ~/drone\\ acuatico && source venv_pi/bin/activate"
echo "   nohup python3 drone_server.py > drone_gps.log 2>&1 &"
echo ""
echo "================================================================"
echo "  TIPS"
echo "================================================================"
echo ""
echo "‚Ä¢ A√±ade a favoritos en tu celular para acceso r√°pido"
echo "‚Ä¢ Funciona en modo horizontal para mejor vista del mapa"
echo "‚Ä¢ Los controles t√°ctiles funcionan perfectamente"
echo "‚Ä¢ Puedes tener m√∫ltiples dispositivos conectados"
echo ""
echo "================================================================"
